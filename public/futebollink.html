<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pa√≠ses e Ligas</title>
    <style>
        .country {
            cursor: pointer;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .leagues {
            display: none;
            margin-left: 20px;
        }
        .league {
            cursor: pointer;
            color: blue;
            text-decoration: underline;
            margin-top: 5px;
        }
        .loading {
            color: gray !important;
        }
        .success {
            color: green !important;
        }
        .error {
            color: red !important;
        }
    </style>
</head>
<body>
    <h1>Selecione um Pa√≠s</h1>
    <div id="countries"></div>
    
    <script>
        function formatText(text) {
            return text
                .normalize("NFD")
                .replace(/[\u0300-\u036f]/g, "")
                .toLowerCase()
                .replace(/[^a-z0-9]+/g, "-")
                .replace(/^-+|-+$/g, "");
        }

        const countries = {
    "AM√âRICA DO SUL": ["Ta√ßa dos Libertadores"],
    "Europa": ["Liga dos Campe√µes", "Liga Europa", "Liga Confer√™ncia", "Liga das Na√ß√µes"],
    "Brasil": ["Ta√ßa do Brasil", "Paulista", "Carioca", "Gaucho", "Mineiro", "Ta√ßa do Nordeste", "Goiano", "Catarinense", "Baiano"],
    "Portugal": ["Liga Portugal Betclic", "Ta√ßa de Portugal", "Liga Portugal 2", "Liga 3"],
    "Inglaterra": ["Premier League", "Championship", "Trof√©u FA", "Ta√ßa da Liga EFL", "Liga 1"],
    "Espanha": ["LaLiga", "Segunda Divisi√≥n", "Ta√ßa do Rei de Espanha", "Primeira RFEF - Grupo 1"],
    "It√°lia": ["S√©rie A", "S√©rie B", "Ta√ßa de It√°lia"],
    "Alemanha": ["Bundesliga", "Ta√ßa da Alemanha", "2 Bundesliga", "3 Liga Alema"],
    "Fran√ßa": ["Liga 1", "Liga2", "Nacional"],
    "EUA": ["MLS"],
    "Jap√£o": ["liga j1", "liga j2"],
    "Ar√°bia Saudita": ["Primeira Liga"],
    "Pa√≠ses Baixos": ["Eredivisie", "Ta√ßa KNVB Beker", "Primeira Divis√£o"],
    "Turquia": ["Super liga", "1 lig"],
    "√Åustria": ["Primeira Liga", "Segunda Liga"],
    "B√©lgica": ["Primeira Liga", "Segunda Liga"],
    "Bulg√°ria": ["Liga Parva"],
    "Chipre": ["Primeira Liga"],
    "Cro√°cia": ["Primeira Liga", "Prva NL", "Ta√ßa"],
    "Dinamarca": ["Super liga", "1a Divisao"],
    "Esc√≥cia": ["Primeira Liga", "Divisao 1"],
    "Eslov√°quia": ["Primeira Liga"],
    "Eslov√©nia": ["Liga Prva", "Ta√ßa"],
    "Finl√¢ndia": ["Ta√ßa da Liga"],
    "Gr√©cia": ["Superliga", "Ta√ßa", "Super Liga 2"],
    "Hungria": ["Primeira Liga", "Ta√ßa"],
    "Irlanda": ["Primeira Divis√£o", "Divis√£o 1"],
    "Irlanda do Norte": ["Primeira Liga NIFL"],
    "Israel": ["liga ha al", "Ta√ßa Estadual"],
    "Montenegro": ["Liga Prva Crnogorska"],
    "Pa√≠s de Gales": ["Primeira Liga Cymru"],
    "Pol√≥nia": ["Primeira Liga", "Divisao 1", "Ta√ßa"],
    "Rep√∫blica Checa": ["Primeira Liga", "Ta√ßa MOL", "Segunda Divis√£o"],
    "Rom√©nia": ["Superliga", "Ta√ßa", "Liga 2"],
    "Su√≠√ßa": ["Superliga", "Ta√ßa da Sui√ßa", "Liga Challenge"],
    "Ucr√¢nia": ["Primeira Liga"],
    "Argentina": ["Torneo Betano", "Ta√ßa da Argentina", "Primeira Liga Nacional"],
    "Chile": ["Liga de Primera", "Liga de Ascenso", "Copa Chile"],
    "Col√¥mbia": ["Primeira A", "Primeira B"],
    "Costa Rica": ["Primeira Divis√£o"],
    "Equador": ["Liga Pro"],
    "M√©xico": ["Liga MX", "Liga de Expansion MX", "Liga MX Feminino"],
    "Panam√°": ["Primeira Liga"],
    "Paraguai": ["Copa de Primera"],
    "Peru": ["Liga 1"],
    "Uruguai": ["Liga AUF Uruguaya"],
    "√Åfrica do Sul": ["Primeira Liga"],
    "Angola": ["Girabola"],
    "Arg√©lia": ["1 Divisao"],
    "Austr√°lia": ["Liga A"],
    "Catar": ["Primeira Liga"],
    "China": ["Superliga"],
    "Coreia do Sul": ["Liga K1", "Liga K2"],
    "Egito": ["Primeira Liga"],
    "√çndia": ["Super Liga"],
    "Indon√©sia": ["Liga 1"],
    "Tail√¢ndia": ["Liga 1"],
    "Tanz√¢nia": ["Liga Kuu Bara"],
    "Tun√≠sia": ["Liga Profissional 1"]
        };

        const countryContainer = document.getElementById("countries");

        for (let country in countries) {
            let countryElement = document.createElement("div");
            countryElement.classList.add("country");
            countryElement.textContent = country;
            countryContainer.appendChild(countryElement);
            
            let leaguesDiv = document.createElement("div");
            leaguesDiv.classList.add("leagues");
            
            countries[country].forEach(league => {
                let leagueElement = document.createElement("div");
                leagueElement.textContent = league;
                leagueElement.classList.add("league");

leagueElement.addEventListener("click", async (event) => {
    event.stopPropagation();


let formattedCountry = formatText(country);
let formattedLeague = formatText(league);
let url = `https://www.flashscore.pt/futebol/${formattedCountry}/${formattedLeague}/lista/`;

// Criando o nome da tabela com o pa√≠s antes da liga
let tableName = `${formattedCountry}_${formattedLeague}`
    .normalize("NFD").replace(/[\u0300-\u036f]/g, "") // Remove acentos
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, "_") + "_link"; // Substitui caracteres especiais por "_"

console.log(`üìå Nome da tabela extra√≠do: ${tableName}`);

    leagueElement.classList.add("loading");

    alert(`‚è≥ Processando liga ${league}... Aguarde!`);

    try {
        console.log("üì§ Enviando URL e tableName:", url, tableName);
        const response = await fetch("https://analise-jpnba.onrender.com/salvar-url", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ url, tableName }) // Enviando tableName
        });

        const result = await response.json();
        console.log("‚úÖ Resposta do servidor (salvar-url):", result);

        if (!result.success && result.message !== "URL j√° est√° salva!") {
    throw new Error("Erro ao salvar a URL.");
}



console.log("üöÄ Executando script futebollink...");
        const executeScriptResponse = await fetch("https://analise-jpnba.onrender.com/futebollink", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ tableName }) // Passando a liga selecionada
        });


        const executeResult = await executeScriptResponse.text();
        console.log("‚öΩ Script futebollink executado:", executeResult);

       
    
        
        console.log("üöÄ Executando script Dados dos Times...");
        const executedadostResponse = await fetch("https://analise-jpnba.onrender.com/timefutebol", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ tableName }) // Passando tableName para o backend
        });

        const executedadosResult = await executedadostResponse.text();
        console.log("‚öΩ Script Dados dos Times executado:", executedadosResult);

console.log("üé≤ Executando script oddsfutebol...");
        const executeOddsResponse = await fetch("https://analise-jpnba.onrender.com/oddsfutebol", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ tableName }) // Passando tableName para o backend
        });

        const executeOddsResult = await executeOddsResponse.text();
        console.log("‚úÖ Script oddsfutebol executado:", executeOddsResult);


         






        leagueElement.classList.remove("loading");
        leagueElement.classList.add("success");

        alert(`‚úÖ Liga ${league} processada com sucesso!\nURL: ${url}`);
    } catch (error) {
        console.error("‚ùå Erro ao processar liga:", error);
        alert("‚ùå Ocorreu um erro ao processar a liga. Tente novamente.");
        leagueElement.classList.remove("loading");
        leagueElement.classList.add("error");
    }
});

                leaguesDiv.appendChild(leagueElement);
            });

            countryElement.addEventListener("click", () => {
                leaguesDiv.style.display = leaguesDiv.style.display === "block" ? "none" : "block";
            });

            countryContainer.appendChild(leaguesDiv);
        }
    </script>
</body>
</html>
